<!--IoPlus config-->
<script type="text/x-red" data-template-name="IoPlus">
    <div class="form-row">
        <label for="node-config-input-IoPlus"><i class="fa fa-random"></i> <span data-i18n="IoPlus.label.ioplus"></span></label>
        <input type="text" id="node-config-input-IoPlus" style="width:60%;" data-i18n="[placeholder]IoPlus.placeholder.ioplus">
        <a id="node-config-lookup-IoPlus" class="btn"><i id="node-config-lookup-serial-icon" class="fa fa-search"></i></a>
    </div>
    <div class="form-row">
        <table width="100%">
            <tr>
                <td width="100px"><i class="fa fa-wrench"></i> <span data-i18n="IoPlus.label.settings"></span></td>
                <td width="110px" data-i18n="IoPlus.label.bus"></td>
            </tr>
            <tr>
                <td>&nbsp;</td>
                <td>
                    <input type="text" id="node-config-input-bus" style="width:100px">
                </td>
                <td></td>
            </tr>
        </table>
    </div>
    <br />
    <div class="form-tips" id="tip-split"><span data-i18n="IoPlus.tip.split"></span></div>
</script>

<script type="text/x-red" data-help-name="IoPlus">
    <p>Provides configuration options for a serial port.</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('IoPlus', {
        category: 'config',
        defaults: {
            name: { value: "ioplus" },
            IoPlus: { value: "", required: true },
            bus: { value: 32, required: true, validate: RED.validators.number() }
        },
        label: function () {
            this.bus = this.bus || 32;
            return this.IoPlus + ":" + this.bus;
        },
        oneditprepare: function () {
            var previous = null;
            var blist = [
                { value: 32, label: "0x20", hasValue: false },
                { value: 33, label: "0x21", hasValue: false },
                { value: 34, label: "0x22", hasValue: false },
                { value: 35, label: "0x23", hasValue: false },
                { label: "other", value: "other", icon: "red/images/typedInput/09.png", validate: /^[0-9]*$/ }
            ];
            var busType = "custom";
            for (var i in blist) {
                if (this.bus == blist[i].value) {
                    busType = this.bus;
                }
            }
            $("#node-config-input-bus").typedInput({
                default: this.bus,
                types: blist
            });
        },
        oneditsave: function () {
            var mytype = $("#node-config-input-bus").typedInput('type');
            if (mytype !== "other") {
                $("#node-config-input-bus").typedInput('value', mytype);
            }
            this.bus = $("#node-config-input-bus").typedInput('value');
        }
    });
</script>

<!--IoPlus out-->
<script type="text/x-red" data-template-name="IoPlus out">
    <div class="form-row node-input-IoPlus">
        <label for="node-input-IoPlus"><i class="fa fa-random"></i> <span data-i18n="IoPlus.label.ioplus"></span></label>
        <input type="text" id="node-input-IoPlus">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>
</script>

<script type="text/x-red" data-help-name="IoPlus out">
    <p>Provides a connection to an outbound serial port.</p>
    <p>Only the <code>msg.payload</code> is sent.</p>
    <p>Optionally the new line character used to split the input can be appended to every message sent out to the serial port.</p>
    <p>Binary payloads can be sent by using a Buffer object.</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('IoPlus out', {
        category: 'Raspberry Pi',
        defaults: {
            name: { name: "" },
            IoPlus: { value: "", type: "IoPlus", required: true }
        },
        color: "BurlyWood",
        inputs: 1,
        outputs: 0,
        icon: "serial.png",
        align: "right",
        label: function () {
            var ioplusNode = RED.nodes.node(this.IoPlus);
            return this.name || (ioplusNode ? ioplusNode.label().split(":")[0] : this._("IoPlus.label.ioplus"));
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        }
    });
</script>

<!--IoPlus in-->
<script type="text/x-red" data-template-name="IoPlus in">
    <div class="form-row node-input-IoPlus">
        <label for="node-input-IoPlus"><i class="fa fa-random"></i> <span data-i18n="IoPlus.label.ioplus"></span></label>
        <input type="text" id="node-input-IoPlus">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>

    <div class="form-row">
        <label for="node-input-pin"><i class="fa fa-tag"></i> <span data-i18n="IoPlus.label.pin"></span></label>
        <input type="text" id="node-input-pin">
    </div>
</script>

<script type="text/x-red" data-help-name="IoPlus in">
    <p>Read the value of an individual pin 1 - 16</p>
    <p>returns 0 = logic level low, 1 = logic level high</p>
    <p>pin number in <code>msg.payload</code></p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('IoPlus in', {
        category: 'Raspberry Pi',
        defaults: {
            name: { name: "" },
            IoPlus: { value: "", type: "IoPlus", required: true },
            pin: { value: 1, required: true, validate: RED.validators.number() }
        },
        color: "BurlyWood",
        inputs: 0,
        outputs: 1,
        icon: "serial.png",
        align: "right",
        label: function () {
            var ioplusNode = RED.nodes.node(this.IoPlus);
            return this.name || (ioplusNode ? ioplusNode.label().split(":")[0] : this._("IoPlus.label.ioplus"));
        },
        labelStyle: function () {
            return this.name ? "node_label_italic" : "";
        }
    });
</script>
